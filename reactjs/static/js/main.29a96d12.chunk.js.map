{"version":3,"sources":["jquery.js","Editor.js","index.js","../../mathquill4quill.js"],"names":["window","jQuery","$","katex","Editor","reactQuill","React","createRef","mathquill4quill","Quill","enableMathQuillFormulaAuthoring","this","current","editor","props","options","ref","id","modules","formula","toolbar","placeholder","theme","Component","CUSTOM_OPERATORS","Index","useState","operators","setOperators","displayHistory","setDisplayHistory","displayDeleteButtonOnHistory","setDisplayDeleteButtonOnHistory","className","JSON","stringify","type","onChange","event","target","checked","href","width","height","src","alt","ReactDOM","render","StrictMode","document","getElementById","dependencies","MathQuill","localStorage","getCacheItem","key","getItem","e","quill","getTooltip","container","getElementsByClassName","getLatexInput","getElementsByTagName","MutationObserver","console","log","tooltip","historyCacheKey","historyList","parse","fetchHistoryList","historySize","mqInput","autofocus","mathQuillConfig","cacheKey","mqField","latexInputStyle","syncMathquillToQuill","latexInput","saveButton","handlers","edit","latex","value","setItem","setCacheItem","enter","click","getInterface","MathField","cachedLatex","addEventListener","item","length","index","indexOf","splice","unshift","pop","addItemToHistoryList","removeItem","removeCacheItem","newNode","referenceNode","setAttribute","applyMathquillInputStyles","createElement","applyLatexInputStyles","setTimeout","focus","autofocusFormulaField","parentNode","insertBefore","nextSibling","destroy","remove","newMathquillInput","operatorButtons","applyOperatorContainerStyles","forEach","element","button","displayOperator","operator","throwOnError","onclick","test","isOperatorCommand","write","cmd","createOperatorButton","applyOperatorButtonStyles","appendChild","newOperatorButtons","historyListButtons","history","historyDiv","getBoundingClientRect","top","style","fixToolTipHeight","withDeleteButton","applyHistoryContainerStyles","header","innerHTML","createHistoryButton","applyHistoryButtonStyles","innerContainer","applyHistoryInnerContainerStyles","deleteButton","applyHistoryDeleteButtonStyles","array","removeItemFromHistoryList","newHistoryList","classList","contains","attributes","observe","attributeFilter","module","exports","prototype"],"mappings":"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","file":"static/js/main.29a96d12.chunk.js","sourcesContent":["import $ from \"jquery\";\n\nwindow.jQuery = window.$ = $;\n","// KaTeX dependency\nimport katex from \"katex\";\nwindow.katex = katex;\nimport \"katex/dist/katex.css\";\n\n// Quill dependency\nimport ReactQuill, { Quill } from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\n// MathQuill dependency\nimport \"./jquery\";\nimport \"@edtr-io/mathquill/build/mathquill.js\";\nimport \"@edtr-io/mathquill/build/mathquill.css\";\n\n// mathquill4quill include\nimport mathquill4quill from \"mathquill4quill\";\nimport \"mathquill4quill/mathquill4quill.css\";\n\n// demo page\nimport React from \"react\";\n\nexport default class Editor extends React.Component {\n  reactQuill = React.createRef();\n\n  componentDidMount() {\n    const enableMathQuillFormulaAuthoring = mathquill4quill({ Quill, katex });\n    enableMathQuillFormulaAuthoring(\n      this.reactQuill.current.editor,\n      this.props.options\n    );\n  }\n\n  render() {\n    return (\n      <ReactQuill\n        ref={this.reactQuill}\n        id=\"editor\"\n        modules={{\n          formula: true,\n          toolbar: [[\"video\", \"bold\", \"italic\", \"underline\", \"formula\"]]\n        }}\n        placeholder=\"Type text here, or click on the formula button to enter math.\"\n        theme=\"snow\"\n      />\n    );\n  }\n}\n","import React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Editor from \"./Editor\";\nimport \"./index.css\";\n\nconst CUSTOM_OPERATORS = [\n  [\"\\\\pm\", \"\\\\pm\"],\n  [\"\\\\sqrt{x}\", \"\\\\sqrt\"],\n  [\"\\\\sqrt[3]{x}\", \"\\\\sqrt[3]{}\"],\n  [\"\\\\sqrt[n]{x}\", \"\\\\nthroot\"],\n  [\"\\\\frac{x}{y}\", \"\\\\frac\"],\n  [\"\\\\sum^{s}_{x}{d}\", \"\\\\sum\"],\n  [\"\\\\prod^{s}_{x}{d}\", \"\\\\prod\"],\n  [\"\\\\coprod^{s}_{x}{d}\", \"\\\\coprod\"],\n  [\"\\\\int^{s}_{x}{d}\", \"\\\\int\"],\n  [\"\\\\binom{n}{k}\", \"\\\\binom\"]\n];\n\nfunction Index() {\n  const [operators, setOperators] = useState([]);\n  const [displayHistory, setDisplayHistory] = useState(false);\n  const [\n    displayDeleteButtonOnHistory,\n    setDisplayDeleteButtonOnHistory\n  ] = useState(false);\n\n  const toggleDisplayHistory = event => {\n    setDisplayHistory(event.target.checked);\n  };\n\n  const toggleDisplayDeleteOnHistory = event => {\n    setDisplayDeleteButtonOnHistory(event.target.checked);\n  };\n\n  const toggleOperators = event => {\n    setOperators(event.target.checked ? CUSTOM_OPERATORS : []);\n  };\n\n  const options = { displayHistory, operators, displayDeleteButtonOnHistory };\n\n  return (\n    <main className=\"demo-container\">\n      <Editor options={options} key={JSON.stringify(options)} />\n\n      <label>\n        Use custom operator buttons:\n        <input type=\"checkbox\" className=\"option\" onChange={toggleOperators} />\n      </label>\n\n      <label>\n        Display formula history:\n        <input\n          type=\"checkbox\"\n          className=\"option\"\n          onChange={toggleDisplayHistory}\n        />\n      </label>\n      <label>\n        Display delete button on formula history:\n        <input\n          type=\"checkbox\"\n          className=\"option\"\n          onChange={toggleDisplayDeleteOnHistory}\n        />\n      </label>\n\n      <footer>\n        <a href=\"https://github.com/c-w/mathquill4quill\">\n          <p>Fork me on Github</p>\n          <img\n            width=\"149\"\n            height=\"149\"\n            src=\"https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149\"\n            alt=\"Fork me on GitHub\"\n          />\n        </a>\n      </footer>\n    </main>\n  );\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <Index />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n","/* eslint-env browser, commonjs */\n\nwindow.mathquill4quill = function(dependencies) {\n  dependencies = dependencies || {};\n\n  const Quill = dependencies.Quill || window.Quill;\n  const MathQuill = dependencies.MathQuill || window.MathQuill;\n  const katex = dependencies.katex || window.katex;\n  const localStorage = dependencies.localStorage || window.localStorage;\n\n  function setCacheItem(key, value) {\n    try {\n      localStorage.setItem(key, value);\n    } catch (e) {\n      // eslint-disable-line no-empty\n    }\n  }\n\n  function getCacheItem(key) {\n    try {\n      return localStorage.getItem(key);\n    } catch (e) {\n      return \"\";\n    }\n  }\n\n  function removeCacheItem(key) {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      // eslint-disable-line no-empty\n    }\n  }\n\n  function insertAfter(newNode, referenceNode) {\n    referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n  }\n\n  function isOperatorCommand(operator) {\n    return /^\\\\[A-Za-z]+$/.test(operator);\n  }\n\n  function enableMathQuillFormulaAuthoring(quill, options) {\n    options = options || {};\n\n    function areAllDependenciesMet() {\n      if (!Quill) {\n        console.log(\"Quill.js not loaded\"); // eslint-disable-line no-console\n        return false;\n      }\n\n      if (!MathQuill) {\n        console.log(\"MathQuill.js not loaded\"); // eslint-disable-line no-console\n        return false;\n      }\n\n      if (!katex) {\n        console.log(\"katex.js not loaded\"); // eslint-disable-line no-console\n        return false;\n      }\n\n      if (!quill.options.modules.formula) {\n        console.log(\"Formula module not enabled\"); // eslint-disable-line no-console\n        return false;\n      }\n\n      if (!MutationObserver) {\n        console.log(\"MutationObserver not defined\"); // eslint-disable-line no-console\n        return false;\n      }\n\n      return true;\n    }\n\n    function fetchHistoryList(key) {\n      try {\n        return JSON.parse(localStorage.getItem(key)) || [];\n      } catch (e) {\n        return [];\n      }\n    }\n\n    function addItemToHistoryList(key) {\n      const item = getCacheItem(key);\n      if (item && item.length > 0) {\n        const index = historyList.indexOf(item);\n        if (index != -1) {\n          historyList.splice(index, 1);\n        }\n        historyList.unshift(item);\n        if (historyList.length > historySize) historyList.pop();\n        try {\n          localStorage.setItem(historyCacheKey, JSON.stringify(historyList));\n        } catch (e) {\n          // eslint-disable-line no-empty\n        }\n      }\n    }\n\n    function removeItemFromHistoryList(array, index) {\n      array.splice(index, 1);\n      try {\n        localStorage.setItem(historyCacheKey, JSON.stringify(array));\n      } catch (e) {\n        // eslint-disable-line no-empty\n      }\n    }\n\n    function getTooltip() {\n      return quill.container.getElementsByClassName(\"ql-tooltip\")[0];\n    }\n\n    function getSaveButton() {\n      const tooltip = getTooltip();\n      return tooltip.getElementsByClassName(\"ql-action\")[0];\n    }\n\n    function getLatexInput() {\n      const tooltip = getTooltip();\n      return tooltip.getElementsByTagName(\"input\")[0];\n    }\n\n    function newMathquillInput() {\n      const autofocus = options.autofocus == null ? true : options.autofocus;\n      const mathQuillConfig =\n        options.mathQuillConfig != null ? options.mathQuillConfig : {};\n      const cacheKey = options.cacheKey || \"__mathquill4quill_cache__\";\n      let mqInput = null;\n      let mqField = null;\n      let latexInputStyle = null;\n\n      function applyMathquillInputStyles(mqInput) {\n        mqInput.setAttribute(\"class\", \"mathquill4quill-mathquill-input\");\n      }\n\n      function applyLatexInputStyles(latexInput) {\n        latexInput.setAttribute(\"class\", \"mathquill4quill-latex-input\");\n      }\n\n      function syncMathquillToQuill(latexInput, saveButton) {\n        const handlers =\n          mathQuillConfig.handlers == null ? {} : mathQuillConfig.handlers;\n        mathQuillConfig.handlers = {\n          ...handlers,\n          edit() {\n            const latex = mqField.latex();\n            latexInput.value = latex;\n            setCacheItem(cacheKey, latex);\n          },\n          enter() {\n            saveButton.click();\n          }\n        };\n        const mqField = MathQuill.getInterface(2).MathField(\n          mqInput,\n          mathQuillConfig\n        );\n\n        const cachedLatex = getCacheItem(cacheKey);\n        if (cachedLatex) {\n          mqField.latex(cachedLatex);\n        }\n\n        saveButton.addEventListener(\"click\", () => {\n          addItemToHistoryList(cacheKey);\n          removeCacheItem(cacheKey);\n        });\n\n        return mqField;\n      }\n\n      function autofocusFormulaField(mqField) {\n        if (!autofocus) {\n          return;\n        }\n\n        window.setTimeout(() => mqField.focus(), 1);\n      }\n\n      return {\n        render() {\n          if (mqInput != null) {\n            return;\n          }\n\n          const latexInput = getLatexInput();\n          const saveButton = getSaveButton();\n\n          mqInput = document.createElement(\"span\");\n          applyMathquillInputStyles(mqInput);\n\n          latexInputStyle = latexInput.className;\n          applyLatexInputStyles(latexInput);\n\n          mqField = syncMathquillToQuill(latexInput, saveButton);\n          autofocusFormulaField(mqField);\n\n          insertAfter(mqInput, latexInput);\n          return mqField;\n        },\n        destroy() {\n          if (mqInput == null) {\n            return;\n          }\n\n          const latexInput = getLatexInput();\n\n          latexInput.setAttribute(\"class\", latexInputStyle);\n\n          mqInput.remove();\n          mqInput = null;\n        }\n      };\n    }\n\n    function newOperatorButtons() {\n      const operators = options.operators || [];\n      let container = null;\n\n      function applyOperatorButtonStyles(button) {\n        button.setAttribute(\"class\", \"mathquill4quill-operator-button\");\n      }\n\n      function applyOperatorContainerStyles(container) {\n        container.setAttribute(\"class\", \"mathquill4quill-operator-container\");\n      }\n\n      function createOperatorButton(element, mqField) {\n        const displayOperator = element[0];\n        const operator = element[1];\n\n        const button = document.createElement(\"button\");\n        button.setAttribute(\"type\", \"button\");\n        button.setAttribute(\"data-value\", operator);\n\n        katex.render(displayOperator, button, {\n          throwOnError: false\n        });\n        button.onclick = () => {\n          if (isOperatorCommand(operator)) {\n            mqField.cmd(operator);\n          } else {\n            mqField.write(operator);\n          }\n          mqField.focus();\n        };\n\n        return button;\n      }\n\n      return {\n        render(mqField) {\n          if (container != null || operators.length === 0) {\n            return;\n          }\n\n          const tooltip = getTooltip();\n\n          container = document.createElement(\"div\");\n          applyOperatorContainerStyles(container);\n\n          operators.forEach(element => {\n            const button = createOperatorButton(element, mqField);\n            applyOperatorButtonStyles(button);\n            container.appendChild(button);\n          });\n\n          tooltip.appendChild(container);\n        },\n        destroy() {\n          if (container == null) {\n            return;\n          }\n\n          container.remove();\n          container = null;\n        }\n      };\n    }\n\n    function newHistoryList() {\n      const history = historyList || [];\n      let historyDiv = null;\n\n      function applyHistoryButtonStyles(button) {\n        button.setAttribute(\"class\", \"mathquill4quill-history-button\");\n      }\n\n      function applyHistoryInnerContainerStyles(container) {\n        container.setAttribute(\n          \"class\",\n          \"mathquill4quill-history-inner-container\"\n        );\n      }\n\n      function applyHistoryDeleteButtonStyles(button) {\n        button.setAttribute(\"class\", \"mathquill4quill-history-delete-button\");\n        button.setAttribute(\"title\", \"Delete\");\n        button.setAttribute(\"role\", \"button\");\n      }\n\n      function applyHistoryContainerStyles(container, withDeleteButton) {\n        let className = \"mathquill4quill-history-container\";\n        if (withDeleteButton) {\n          className += \" mathquill4quill-history-container-with-delete-button\";\n        }\n        container.setAttribute(\"class\", className);\n      }\n\n      function createHistoryButton(latex, mqField) {\n        const button = document.createElement(\"button\");\n        button.setAttribute(\"type\", \"button\");\n\n        katex.render(latex, button, {\n          throwOnError: false\n        });\n        button.onclick = () => {\n          mqField.write(latex);\n          mqField.focus();\n        };\n\n        return button;\n      }\n\n      return {\n        render(mqField) {\n          fixToolTipHeight();\n\n          if (historyDiv != null || !displayHistory || history.length === 0) {\n            return;\n          }\n\n          const tooltip = getTooltip();\n\n          historyDiv = document.createElement(\"div\");\n          let container = document.createElement(\"div\");\n          applyHistoryContainerStyles(container, displayDeleteButtonOnHistory);\n          let header = document.createElement(\"p\");\n          header.innerHTML = \"Past formulas (max \" + historySize + \")\";\n          historyDiv.appendChild(header);\n\n          history.forEach(element => {\n            const button = createHistoryButton(element, mqField);\n            applyHistoryButtonStyles(button);\n            if (displayDeleteButtonOnHistory) {\n              const innerContainer = document.createElement(\"div\");\n              applyHistoryInnerContainerStyles(innerContainer);\n              const deleteButton = document.createElement(\"div\");\n              applyHistoryDeleteButtonStyles(deleteButton);\n              deleteButton.addEventListener(\"click\", () => {\n                innerContainer.remove();\n                const index = history.indexOf(element);\n                removeItemFromHistoryList(history, index);\n              });\n              innerContainer.appendChild(button);\n              innerContainer.appendChild(deleteButton);\n              container.appendChild(innerContainer);\n            } else {\n              container.appendChild(button);\n            }\n          });\n          historyDiv.appendChild(container);\n          tooltip.appendChild(historyDiv);\n        },\n        destroy() {\n          if (historyDiv == null) {\n            return;\n          }\n\n          historyDiv.remove();\n          historyDiv = null;\n        }\n      };\n    }\n\n    // If tooltip hangs below Quill div, Quill will position tooltip in bad place if function is clicked twice\n    // This addresses the position issue\n    function fixToolTipHeight() {\n      const tooltip = getTooltip();\n\n      if (\n        tooltip.getBoundingClientRect().top -\n          quill.container.getBoundingClientRect().top <\n        0\n      ) {\n        tooltip.style.top = \"0px\";\n      }\n    }\n\n    if (!areAllDependenciesMet()) {\n      return;\n    }\n\n    const tooltip = getTooltip();\n\n    const historyCacheKey =\n      options.historyCacheKey || \"__mathquill4quill_historylist_cache__\";\n    let historyList = fetchHistoryList(historyCacheKey);\n    const historySize = options.historySize || 10;\n    const displayHistory = options.displayHistory || false;\n    const displayDeleteButtonOnHistory =\n      options.displayDeleteButtonOnHistory || false;\n\n    const mqInput = newMathquillInput();\n    const operatorButtons = newOperatorButtons();\n    const historyListButtons = newHistoryList();\n\n    const observer = new MutationObserver(() => {\n      const isFormulaTooltipActive =\n        !tooltip.classList.contains(\"ql-hidden\") &&\n        tooltip.attributes[\"data-mode\"] &&\n        tooltip.attributes[\"data-mode\"].value === \"formula\";\n\n      if (isFormulaTooltipActive) {\n        const mqField = mqInput.render();\n        operatorButtons.render(mqField);\n        historyListButtons.render(mqField);\n      } else {\n        mqInput.destroy();\n        operatorButtons.destroy();\n        historyListButtons.destroy();\n      }\n    });\n\n    observer.observe(tooltip, {\n      attributes: true,\n      attributeFilter: [\"class\", \"data-mode\"]\n    });\n  }\n\n  return enableMathQuillFormulaAuthoring;\n};\n\nif (typeof module !== \"undefined\" && module.exports) {\n  module.exports = window.mathquill4quill;\n}\n\n// for backwards compatibility with prototype-based API\nif (window.Quill) {\n  window.Quill.prototype.enableMathQuillFormulaAuthoring = function(options) {\n    window.mathquill4quill()(this, options);\n  };\n}\n"],"sourceRoot":""}